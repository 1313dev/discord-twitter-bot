"""
The methods bordered() and _get_startup_screen_specs() were copied from https://github.com/Cog-Creators/Red-DiscordBot/
redbot/core/utils/chat_formatting.py     @tekulvw
It is licensed under GNU General Public License v3.0

The rest is unrelated to their project and was written by me.
"""

from typing import Sequence
import itertools
import codecs
import sys


def bordered(*columns: Sequence[str], ascii_border: bool = False) -> str:
    """Get two blocks of text in a borders.
    Note
    ----
    This will only work with a monospaced font.
    Parameters
    ----------
    *columns : `sequence` of `str`
        The columns of text, each being a list of lines in that column.
    ascii_border : bool
        Whether or not the border should be pure ASCII.
    Returns
    -------
    str
        The bordered text.
    """
    borders = {
        "TL": "-" if ascii_border else "┌",  # Top-left
        "TR": "-" if ascii_border else "┐",  # Top-right
        "BL": "-" if ascii_border else "└",  # Bottom-left
        "BR": "-" if ascii_border else "┘",  # Bottom-right
        "HZ": "-" if ascii_border else "─",  # Horizontal
        "VT": "|" if ascii_border else "│",  # Vertical
    }

    sep = " " * 4  # Separator between boxes
    widths = tuple(max(len(row) for row in column) + 9 for column in columns)  # width of each col
    colsdone = [False] * len(columns)  # whether or not each column is done
    lines = [sep.join("{TL}" + "{HZ}" * width + "{TR}" for width in widths)]

    for line in itertools.zip_longest(*columns):
        row = []
        for colidx, column in enumerate(line):
            width = widths[colidx]
            done = colsdone[colidx]
            if column is None:
                if not done:
                    # bottom border of column
                    column = "{HZ}" * width
                    row.append("{BL}" + column + "{BR}")
                    colsdone[colidx] = True  # mark column as done
                else:
                    # leave empty
                    row.append(" " * (width + 2))
            else:
                column += " " * (width - len(column))  # append padded spaces
                row.append("{VT}" + column + "{VT}")

        lines.append(sep.join(row))

    final_row = []
    for width, done in zip(widths, colsdone):
        if not done:
            final_row.append("{BL}" + "{HZ}" * width + "{BR}")
        else:
            final_row.append(" " * (width + 2))
    lines.append(sep.join(final_row))

    return "\n".join(lines).format(**borders)


def _get_startup_screen_specs():
    """Get specs for displaying the startup screen on stdout.
    This is so we don't get encoding errors when trying to print unicode
    emojis to stdout (particularly with Windows Command Prompt).
    Returns
    -------
    `tuple`
        Tuple in the form (`str`, `str`, `bool`) containing (in order) the
        on symbol, off symbol and whether or not the border should be pure ascii.
    """
    encoder = codecs.getencoder(sys.stdout.encoding)
    check_mark = "\N{SQUARE ROOT}"
    try:
        encoder(check_mark)
    except UnicodeEncodeError:
        on_symbol = "[X]"
        off_symbol = "[ ]"
    else:
        on_symbol = check_mark
        off_symbol = "X"

    try:
        encoder("┌┐└┘─│")  # border symbols
    except UnicodeEncodeError:
        ascii_border = True
    else:
        ascii_border = False

    return on_symbol, off_symbol, ascii_border


def pprint(config):
    on_symbol, off_symbol, ascii_border = _get_startup_screen_specs()

    follow = []
    track = []
    location = []
    webhook_urls = []
    for element in config["Discord"]:
        follow.extend(x for x in element.get("twitter_ids", []) if x not in follow)
        track.extend(x for x in element.get("track", []) if x not in track)
        location.extend(x for x in element.get("location", []))
        webhook_urls.extend(x for x in element.get("webhook_urls", []))

    INFO = [
        "        _   _ _   _ _____ _                 ____ _____ ____",
        "       | \ | | \ | |_   _(_)_ __           |  _ \_   _| __ )",
        "       |  \| |  \| | | | | | '_ \   _____  | | | || | |  _ \\",
        "       | |\  | |\  | | | | | | | | |_____| | |_| || | | |_) |",
        "       |_| \_|_| \_| |_| |_|_| |_|         |____/ |_| |____/",
        "",
        "Discord-Twitter-Bot has a detailed documentation, found here:",
        "https://nntin.github.io/discord-twitter-bot",
        "",
        "Twitter Users: {}".format(len(follow)),
        "Tracked Words: {}".format(len(track)),
        "Location Boxes: {}".format(int(len(location)/4)),
        "Webhook URLs: {}".format(len(webhook_urls)),
        "Defined Feeds: {}".format(len(config["Discord"]))
    ]
    print(bordered(INFO, ascii_border=ascii_border))

    INFOS = []
    for instance in config["Discord"]:
        instance_info = []
        options = (
            ("Include Reply To User", instance.get("IncludeReplyToUser", True)),
            ("Include User Reply", instance.get("IncludeUserReply", True)),
            ("Include Retweet", instance.get("IncludeRetweet", True)),
            ("Custom Message", True if instance.get("custom_message", "") is not "" else False),
            ("Keyword Sets", True if instance.get("keyword_sets", "") is not "" else False),
            ("Blackword Sets", True if instance.get("blackword_sets", "") is not "" else False)
        )
        for option, enabled in options:
            enabled = on_symbol if enabled else off_symbol
            instance_info.append("{} {}".format(enabled, option))

        if instance.get("twitter_ids", []):
            instance_info.append("Twitter Users: {}".format(len(instance["twitter_ids"])))
        if instance.get("track", []):
            instance_info.append("Track Words: {}".format(len(instance["track"])))
        if instance.get("location", []):
            instance_info.append("Location Boxes: {}".format(int(len(instance["location"])/4)))
        if instance.get("webhook_urls", []):
            instance_info.append("Webhook URLs: {}".format(len(instance["webhook_urls"])))

        INFOS.append(instance_info)

    i = 0
    while i < len(INFOS):
        print(bordered(*INFOS[i:i+2], ascii_border=ascii_border))
        i += 2


if __name__ == '__main__':
    config = {'Twitter': {'access_token': 'X-X', 'access_token_secret': 'X', 'consumer_key': 'X', 'consumer_secret': 'X'}, 'Discord': [{'IncludeReplyToUser': True, 'IncludeRetweet': True, 'IncludeUserReply': True, 'twitter_ids': ['3065618342'], 'webhook_urls': ['https://discordapp.com/api/webhooks/123456/XXXXXX']}, {'IncludeReplyToUser': False, 'IncludeRetweet': False, 'IncludeUserReply': False, 'twitter_lists': ['https://twitter.com/rokxx/lists/dota-2'], 'webhook_urls': ['https://discordapp.com/api/webhooks/123456/XXXXXX'], 'twitter_ids': ['827517035538165762', '771033404955504640', '761313186284920832', '748870151215443968', '736342985319800833', '705811683076395008', '4692074893', '4575793752', '4554478933', '4487728163', '3907466052', '3593639369', '3589265476', '3440528535', '3439668053', '3432655593', '3338968180', '3310327604', '3303269889', '3300917663', '3242480829', '3216123239', '3061512574', '3052050280', '3047038643', '3037290961', '3033487485', '2996610345', '2970958139', '2956754815', '2955166565', '2938938385', '2889270322', '2879514418', '2870796886', '2869324601', '2865716541', '2863987731', '2812310104', '2800406853', '2796397921', '2780646499', '2777312755', '2773714579', '2725228346', '2649708270', '2615830670', '2604251359', '2603869602', '2592744180', '2582252852', '2567400864', '2553552858', '2491371260', '2482513555', '2481913412', '2471345334', '2469779858', '2467195614', '2464043784', '2459703620', '2453441874', '2445701851', '2428452410', '2411955139', '2410784130', '2404681705', '2400228572', '2386217856', '2382714398', '2372553726', '2361167905', '2352066902', '2348870683', '2340148272', '2339669515', '2329911342', '2321353982', '2319965270', '2301819336', '2285204556', '2280441901', '2265082196', '2235742716', '2235339294', '2196643610', '2191768050', '2191044079', '2175366870', '2154246463', '2148067442', '1962751351', '1948009400', '1943370512', '1940262770', '1940226188', '1930032192', '1890112758', '1882748173', '1879369416', '1864753722', '1863948846', '1861889875', '1852461140', '1710754705', '1689114020', '1686409308', '1681728685', '1646385560', '1604298906', '1585064574', '1572641863', '1530999505', '1530822530', '1510291615', '1472179928', '1470288122', '1466374340', '1452520626', '1444517990', '1423590463', '1393184251', '1392357157', '1378252098', '1374715688', '1336663478', '1335093780', '1324698572', '1287142711', '1283594461', '1273010972', '1270683193', '1260872838', '1252989409', '1246701048', '1231238136', '1228156986', '1225892959', '1185749900', '1168302188', '1124889985', '1114208214', '1082642528', '1079659363', '1075335967', '1067825672', '1066198542', '1064941080', '1063719126', '1028324108', '1018372472', '1009146318', '1001675731', '983235152', '976425312', '974976086', '949785073', '946665630', '946385166', '938707458', '931383470', '894006060', '888340963', '866794232', '862055424', '860766001', '852129608', '845005633', '834078912', '824303286', '819130742', '807261433', '799327212', '792306224', '789731714', '778719132', '764406294', '762059694', '746882864', '742437204', '738920474', '737005568', '730428108', '719299243', '714535189', '702218011', '637385264', '634640251', '627793203', '623422331', '622515222', '620034214', '617809885', '613451573', '602096713', '595609086', '586206841', '582344429', '580265247', '580029672', '576649003', '576185800', '564965493', '564626355', '563776499', '562375245', '560659842', '554772598', '550312731', '548773222', '548654902', '548611932', '547293931', '542925461', '538267747', '521928542', '514529146', '507182348', '502879331', '500042471', '499855365', '496751891', '493159187', '492809987', '489727015', '488733476', '474796055', '474739648', '461319570', '461147700', '460851542', '457503645', '451884361', '450411157', '442452107', '433788176', '432279860', '430068547', '429466096', '399070033', '393715760', '390150419', '384552831', '378429442', '373059738', '372867550', '370215189', '366653082', '363923240', '357500748', '356965621', '356348186', '354584470', '352636258', '349535869', '346740028', '346729702', '328266448', '321525822', '315742624', '312937997', '312417114', '309366491', '308422941', '303814178', '302739636', '295495025', '294697122', '287564504', '287284747', '284996272', '284982697', '283906817', '281164402', '277385620', '276254547', '275003449', '266442619', '261653690', '260900027', '257268592', '256755816', '251277482', '242848378', '242266033', '238658567', '237097346', '236700415', '226438738', '224393767', '221123734', '217217185', '213921115', '211464941', '210232104', '207120515', '204857157', '194773220', '194518592', '187665378', '184977478', '183241224', '175479505', '169165191', '153288720', '147605676', '143314273', '139169385', '137024504', '131242768', '108685424', '101144163', '96925846', '95164862', '92747246', '87267381', '83568017', '79551388', '75740838', '65211941', '57537292', '52082053', '49644939', '48952825', '47100679', '47051634', '45319754', '44680622', '42384354', '40644641', '36803580', '33230443', '30083335', '29506286', '29145184', '26332904', '26191204', '25143672', '23911853', '22397537', '22351672', '21648994', '20488747', '20447194', '20175678', '19976791', '19768807', '18490175', '18227338', '17388199', '16905329', '15027884', '14427787', '13038392', '11821362', '5636712']}, {'IncludeReplyToUser': False, 'IncludeRetweet': False, 'IncludeUserReply': False, 'twitter_lists': ['https://twitter.com/JacobWolf/lists/league-of-legends-eu', 'https://twitter.com/JacobWolf/lists/league-of-legends-na'], 'webhook_urls': ['https://discordapp.com/api/webhooks/123456/XXXXXX'], 'twitter_ids': ['943829605282062337', '933742066093436929', '910487641564606464', '869192864844087296', '837283780025020422', '805306077323476993', '765989504184385536', '760850325972652032', '756882255516147712', '743833609237323776', '735016708516151296', '703275688493711360', '4910628093', '4393222522', '3400769271', '3376068993', '3326666122', '3300430737', '3246831499', '3246815231', '3238445885', '3230256383', '3199462954', '3092505395', '3044903147', '2996912843', '2984116738', '2961307638', '2943089668', '2902700080', '2901728412', '2893607283', '2871684706', '2831703682', '2790180781', '2776080715', '2767545127', '2685541393', '2651911729', '2617437684', '2590218632', '2559910932', '2540525156', '2494302799', '2493571052', '2479551170', '2476071078', '2460445795', '2400436910', '2387536795', '2387061402', '2303751344', '2282800932', '2275242200', '2274984734', '2239926769', '2216500400', '2216379312', '2199018126', '2180891672', '1961402887', '1648975177', '1648682035', '1648029396', '1613995831', '1592942952', '1439376715', '1250062656', '1086742532', '1076882574', '1048780687', '1042853304', '1007559518', '881827464', '831115278', '762865574', '742842450', '710556630', '622379644', '614754689', '605229725', '553264164', '498258925', '498051521', '497329859', '477670092', '477212920', '435378539', '414063352', '399667930', '393741211', '366839886', '336118770', '320349454', '244581900', '240443350', '201869475', '93046175', '48319230', '21202532', '19244767', '941107389054427136', '932465106709082114', '931476104556228608', '928328069596692480', '900107765389168640', '889558873773752325', '865085363483693056', '837883268699672576', '808739211939631106', '807085574385324032', '796560355384299520', '784642524895776768', '774822427067047936', '767967534163202048', '767434071932866560', '766883429266751488', '735571149057363969', '731049576543584256', '730761203010535425', '720303639277928448', '4871069375', '4854969656', '4843622413', '4728835341', '4716268670', '4605971125', '4445212467', '4145947941', '4130193254', '4014218650', '3510439454', '3354778065', '3339953896', '3333845799', '3318645734', '3307592125', '3303843370', '3240335132', '3196813282', '3180805950', '3110968920', '3033743029', '2986464413', '2968038010', '2967174322', '2963716081', '2957661224', '2921353153', '2881291357', '2870393113', '2842441900', '2806191638', '2802746749', '2801704434', '2562577436', '2550298718', '2500157576', '2467247654', '2460537338', '2454229698', '2431173637', '2418712621', '2402529038', '2385838548', '2358219158', '2355746030', '2317419788', '2274831937', '2259766633', '2255566891', '2157504355', '1974332792', '1891679210', '1887874465', '1695450060', '1635250988', '1571431178', '1549711460', '1531163347', '1483823773', '1392030379', '1323579721', '1312663430', '1299470724', '1244508066', '1195395510', '1158473077', '1158468355', '1029142980', '996374449', '973063820', '911330070', '836016698', '803630550', '797258274', '787917720', '710300755', '637385264', '632498857', '627395451', '606721954', '575352314', '561557225', '559019065', '555641003', '549195074', '521104742', '475439571', '453175900', '449319293', '419920053', '411836598', '409736208', '404781132', '383833528', '358962590', '344538810', '338752873', '321040763', '290495509', '250921910', '250194143', '240941560', '230364687', '205391506', '190632027', '161418822', '131601987', '118767676', '115542264', '111220134', '91402282', '90779436', '76622099', '71871809', '70681150', '56657752', '54720738', '50561395', '32468239', '22601929', '18464135', '16175507', '15690685', '14846901', '14249767', '13824412']}, {'IncludeReplyToUser': False, 'IncludeRetweet': False, 'IncludeUserReply': False, 'twitter_lists': ['https://twitter.com/JacobWolf/lists/counter-strike-na1', 'https://twitter.com/JacobWolf/lists/counter-strike-eu1'], 'webhook_urls': ['https://discordapp.com/api/webhooks/123456/XXXXXX'], 'twitter_ids': ['752555348242739200', '733391851051450370', '732934124646846464', '711346046203375616', '705523136838705155', '4819200268', '4313783901', '3644811674', '3585291673', '3569082262', '3519938177', '3418847474', '3382415499', '3303823908', '3301976534', '3220886666', '3220885052', '3220884152', '3200028695', '3196688655', '3194201842', '3165278857', '3164396304', '3096045595', '3095089653', '3092656036', '3092261302', '3085584765', '3051563503', '3038925132', '2963586039', '2927216186', '2923948912', '2921117964', '2909825480', '2903398510', '2901956871', '2897066342', '2891646213', '2891363009', '2891169758', '2882060932', '2847613102', '2833268733', '2825934283', '2806267256', '2737718485', '2691806484', '2658751782', '2623948854', '2467665067', '2460715879', '2345768564', '2344563715', '2344535443', '2344532400', '2338421173', '2224306837', '2165960455', '2152674686', '1646400956', '1542453360', '1414314709', '1383966553', '1360567010', '1337424932', '1144385460', '941648953', '935995507', '932821405', '897754452', '887137825', '835916678', '793071708', '723113462', '709743942', '700217389', '632531737', '500280341', '474855958', '456474721', '427182684', '420512951', '417490717', '411801536', '406942984', '405201317', '402938330', '390928481', '383501899', '367588473', '329363408', '316155198', '294106552', '250762016', '224791143', '167595513', '112897001', '90779436', '55105195', '53343256', '14229096', '785515916587073536', '4355994922', '4279638075', '4256634797', '4076911385', '3996021815', '3882414256', '3847320507', '3483294076', '3432056793', '3428389355', '3410914911', '3382910399', '3368537541', '3363052793', '3353091027', '3351760203', '3303080043', '3243684837', '3192262779', '3123459139', '3086784504', '3084760869', '3065997231', '3059777301', '2988478943', '2938601992', '2911751007', '2900735327', '2899354721', '2886432789', '2885936045', '2863491107', '2846983649', '2839758562', '2821985738', '2814979514', '2742776272', '2705989106', '2704521262', '2698375908', '2608351688', '2596737199', '2492972971', '2417677048', '2413123389', '2409583842', '2363543587', '2345842486', '2317988042', '2305948997', '2305870420', '2301193351', '2293504651', '2293112606', '2231302969', '2229842017', '1905013717', '1732032055', '1676857266', '1469972862', '1417678880', '1370855934', '1365017234', '1330948909', '1262258485', '1227912542', '1163484408', '1151750658', '1091475487', '1039791163', '1039738116', '1039631064', '958767739', '926744790', '863559200', '619195372', '577114056', '564468347', '552651893', '552366919', '522234690', '503875377', '493249212', '469947002', '467777721', '461876667', '455115368', '425940946', '419782921', '405053787', '402146243', '384855296', '378513090', '363811679', '341536739', '339195461', '321459483', '307886497', '307561952', '304546834', '244441120', '236414181', '176351342', '151739682', '151517444', '116952434', '106470768', '49378085', '47905520', '37411934']}]}
    pprint(config)